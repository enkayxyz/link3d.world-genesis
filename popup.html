<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Link3d Memory</title>
  <!-- 
    We are using all INLINE STYLES.
    This is required by the Manifest v3 Content Security Policy (CSP).
    External stylesheets (like Tailwind CDN) are blocked for security.
  -->
  <style>
    /* Basic Reset & Font */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      width: 350px;
      background-color: #f8fafc; /* gray-50 */
      color: #1e293b; /* gray-800 */
    }
    /* Main Container */
    .container {
      padding: 16px;
    }
    /* Header */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #e2e8f0; /* gray-200 */
      padding-bottom: 12px;
      margin-bottom: 16px;
    }
    .header-title {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .header-title img {
      width: 24px;
      height: 24px;
    }
    .header-title span {
      font-size: 16px;
      font-weight: 600;
      color: #0f172a; /* gray-900 */
    }
    #status-light {
      width: 12px;
      height: 12px;
      border-radius: 9999px;
      background-color: #f59e0b; /* yellow-500 */
    }
    /* Content Card */
    .card {
      background-color: #ffffff;
      border-radius: 8px;
      border: 1px solid #e2e8f0; /* gray-200 */
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      padding: 16px;
    }
    /* Typography */
    .text-sm { font-size: 14px; }
    .text-lg { font-size: 18px; }
    .font-semibold { font-weight: 600; }
    .text-gray-600 { color: #475569; }
    .text-gray-500 { color: #64748b; }
    .text-gray-900 { color: #0f172a; }
    .mb-1 { margin-bottom: 4px; }
    .mb-2 { margin-bottom: 8px; }
    .mb-3 { margin-bottom: 12px; }
    .mb-4 { margin-bottom: 16px; }
    .mt-4 { margin-top: 16px; }
    .block { display: block; }
    
    /* AI Summary Box */
    .ai-summary {
      background-color: #f1f5f9; /* gray-100 */
      border: 1px solid #e2e8f0; /* gray-200 */
      border-radius: 6px;
      padding: 12px;
      font-size: 14px;
      line-height: 1.5;
      color: #334155; /* gray-700 */
    }
    .ai-summary strong {
      color: #1e293b; /* gray-800 */
      font-weight: 600;
      display: block;
      margin-bottom: 4px;
    }

    /* Progress Tracker - Glassmorphic */
    .progress-container {
      background: rgba(255, 255, 255, 0.1);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      padding: 16px;
      margin: 16px 0;
    }
    .progress-step {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
      position: relative;
      padding-left: 20px;
    }
    .progress-step:not(:last-child)::after {
      content: '';
      position: absolute;
      left: 19px;
      top: 32px;
      width: 2px;
      height: calc(100% - 24px);
      background: linear-gradient(to bottom, #3b82f6, #e2e8f0);
      z-index: 1;
    }
    .progress-step:last-child {
      margin-bottom: 0;
    }
    .step-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      margin-right: 12px;
      transition: all 0.3s ease;
    }
    .step-icon.pending { background: #e2e8f0; color: #64748b; }
    .step-icon.active { background: #3b82f6; color: white; animation: pulse 1.5s infinite; }
    .step-icon.success { background: #10b981; color: white; }
    .step-icon.failed { background: #ef4444; color: white; }
    .step-text {
      flex: 1;
      font-size: 14px;
      color: #374151;
    }
    .step-details {
      font-size: 12px;
      color: #6b7280;
      margin-left: 8px;
      cursor: pointer;
      opacity: 0.7;
    }
    .step-details:hover {
      opacity: 1;
    }
    .step-tooltip {
      display: none;
      position: absolute;
      left: 100%;
      top: 0;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: pre-wrap;
      z-index: 10;
      max-width: 200px;
    }
    .step-details:hover + .step-tooltip {
      display: block;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Buttons */
    .button {
      display: block;
      width: 100%;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      padding: 10px 16px;
      border-radius: 6px;
      border: 1px solid transparent;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .button-primary {
      background-color: #2563eb; /* blue-600 */
      color: #ffffff;
    }
    .button-primary:hover {
      background-color: #1d4ed8; /* blue-700 */
    }
    .button-secondary {
      background-color: #16a34a; /* green-600 */
      color: #ffffff;
    }
    .button-secondary:hover {
      background-color: #15803d; /* green-700 */
    }
    .button-warning {
      background-color: #f59e0b; /* yellow-500 */
      color: #1e293b; /* gray-800 */
    }
    .button-warning:hover {
      background-color: #d97706; /* yellow-600 */
    }

    /* States */
    /* All states are hidden by default, JS will show the correct one */
    #loading-state,
    #auth-state,
    #new-contact-state,
    #contact-found-state,
    #success-state,
    #error-state {
      display: none;
    }
  </style>
</head>
<body>

  <div class="container">
    <!-- Header: Visible on all states -->
    <div class="header">
      <div class="header-title">
        <img src="icons/icon48.png" alt="Link3d Logo">
        <span>Link3d Memory</span>
      </div>
      <div id="status-light" title="Status"></div>
    </div>

    <!-- State 1: Loading with Progress -->
    <div id="loading-state" class="card">
      <div class="text-lg font-semibold text-gray-900 mb-2">Processing Profile...</div>
      <div class="progress-container">
        <div class="progress-step" id="step-a">
          <div class="step-icon pending">1</div>
          <div class="step-text">Extracting contact data</div>
          <div class="step-details">+</div>
          <div class="step-tooltip" id="tooltip-a"></div>
        </div>
        <div class="progress-step" id="step-b">
          <div class="step-icon pending">2</div>
          <div class="step-text">AI for analysis</div>
          <div class="step-details">+</div>
          <div class="step-tooltip" id="tooltip-b"></div>
        </div>
        <div class="progress-step" id="step-c">
          <div class="step-icon pending">3</div>
          <div class="step-text">Local AI 1st</div>
        </div>
        <div class="progress-step" id="step-d">
          <div class="step-icon pending">4</div>
          <div class="step-text">Gemini AI fallback</div>
        </div>
        <div class="progress-step" id="step-e">
          <div class="step-icon pending">5</div>
          <div class="step-text">Analysis complete</div>
          <div class="step-details">+</div>
          <div class="step-tooltip" id="tooltip-e"></div>
        </div>
        <div class="progress-step" id="step-f">
          <div class="step-icon pending">6</div>
          <div class="step-text">Google contacts connect</div>
        </div>
        <div class="progress-step" id="step-g">
          <div class="step-icon pending">7</div>
          <div class="step-text">Synching with Google contacts</div>
          <div class="step-details">+</div>
          <div class="step-tooltip" id="tooltip-g"></div>
        </div>
      </div>
    </div>

    <!-- State 2: Needs Authentication -->
    <div id="auth-state" class="card">
      <div class="text-lg font-semibold text-gray-900 mb-2">Permission Needed</div>
      <div class="text-sm text-gray-600 mb-4">
        To sync with your Google Contacts, Link3d needs your permission.
      </div>
      <button id="auth-button" class="button button-warning">
        Authorize Google
      </button>
    </div>

    <!-- State 3: New Contact -->
    <div id="new-contact-state" class="card">
      <div class="text-lg font-semibold text-gray-900 mb-1" id="new-name">Contact Name</div>
      <div class="text-sm text-gray-500 mb-3" id="new-title">Contact Title</div>
      <div class="ai-summary mb-4">
        <strong>AI Memory:</strong>
        <span id="new-ai-summary">Generating AI summary...</span>
      </div>
      <button id="create-button" class="button button-primary">
        Create New Contact
      </button>
    </div>

    <!-- State 4: Contact Found -->
    <div id="contact-found-state" class="card">
      <div class="text-lg font-semibold text-gray-900 mb-1" id="found-name">Contact Name</div>
      <div class="text-sm text-gray-500 mb-3" id="found-title">Contact Title</div>
      <div class="ai-summary mb-4">
        <strong>New AI Memory:</strong>
        <span id="found-ai-summary">Generating AI summary...</span>
      </div>
      <button id="update-button" class="button button-secondary">
        Add Memory to Contact
      </button>
    </div>

    <!-- State 5: Success -->
    <div id="success-state" class="card">
      <div class="text-lg font-semibold text-gray-900 mb-2" style="color: #16a34a;">Success!</div>
      <div class="text-sm text-gray-600" id="success-message">
        Contact updated successfully.
      </div>
    </div>

    <!-- State 6: Error -->
    <div id="error-state" class="card">
      <div class="text-lg font-semibold text-gray-900 mb-2" style="color: #c5221f;">Error</div>
      <div class="text-sm text-gray-600" id="error-message" style="word-wrap: break-word;">
        An unknown error occurred.
      </div>
    </div>

  </div>

  <!-- 
    The script MUST be loaded at the end of the body.
    This ensures all HTML elements (buttons, etc.) exist before the script tries to find them.
    This prevents the "Cannot read properties of null" error.
  -->
  <script src="popup.js"></script>
</body>
</html>

