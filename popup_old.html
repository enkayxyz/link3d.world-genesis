<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Link3d Memory</title>
  <style>
    /* Basic Reset & Font */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      width: 650px;
      min-width: 650px;
      max-width: 650px;
      background-color: #f8fafc;
      color: #1e293b;
    }
    
    /* Main Container */
    .container {
      padding: 16px;
    }
    
    /* Header */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #e2e8f0;
      padding-bottom: 12px;
      margin-bottom: 16px;
    }
    
    .header-title {
      display: flex;
      align-items: center;
        .progress-container {
          background: rgba(255, 255, 255, 0.1);
          -webkit-backdrop-filter: blur(10px);
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.2);
          border-radius: 16px;
          padding: 16px 8px;
          margin: 16px 0;
          display: block;
          white-space: nowrap;
          overflow-x: auto;
          width: 100%;
          box-sizing: border-box;
        }
    }
    /* Content Card */
    .card {
      background-color: #ffffff;
      border-radius: 8px;
      border: 1px solid #e2e8f0; /* gray-200 */
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      padding: 16px;
    }
    /* Typography */
    .text-sm { font-size: 14px; }
        .progress-step {
          display: inline-flex;
          flex-direction: column;
          align-items: center;
          text-align: center;
          position: relative;
          min-width: 70px;
          max-width: 70px;
          margin: 0 8px;
          vertical-align: top;
        }
    
    /* AI Summary Box */
    .ai-summary {
      background-color: #f1f5f9; /* gray-100 */
      border: 1px solid #e2e8f0; /* gray-200 */
      border-radius: 6px;
      padding: 12px;
      font-size: 14px;
      line-height: 1.5;
      color: #334155; /* gray-700 */
        .progress-step:not(:last-child)::after {
          content: '';
          position: absolute;
          top: 16px;
          left: 100%;
          width: 24px;
          height: 2px;
          background: linear-gradient(90deg, #e2e8f0 0%, #cbd5e1 100%);
          z-index: 0;
        }
      background: rgba(255, 255, 255, 0.1);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      padding: 16px;
      margin: 16px 0;
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      gap: 0px;
      justify-content: space-between;
        .step-icon {
          width: 32px;
          height: 32px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 14px;
          font-weight: bold;
          margin-bottom: 8px;
          transition: all 0.3s ease;
          border: 2px solid #e2e8f0;
        }
        .step-icon.pending { background: #e2e8f0; color: #64748b; border-color: #e2e8f0; }
        .step-icon.success { background: #16a34a; color: #fff; border-color: #16a34a; }
        .step-icon.failed { background: #c5221f; color: #fff; border-color: #c5221f; }
        .step-icon.halt { background: #f59e0b; color: #fff; border-color: #f59e0b; }
      box-sizing: border-box;
      overflow-x: auto;
    }
    .progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      position: relative;
      flex: 0 0 90px;
      min-width: 90px;
      max-width: 90px;
      margin: 0 0;
    }
    .progress-step:not(:last-child)::after {
      content: '';
      position: absolute;
      top: 24px;
      right: -45px;
      width: 45px;
      height: 2px;
      background: linear-gradient(90deg, #e2e8f0 0%, #cbd5e1 100%);
      z-index: 0;
    }
    .step-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 8px;
      transition: all 0.3s ease;
    }
    .step-icon.pending { background: #e2e8f0; color: #64748b; }
    .step-icon.active { background: #3b82f6; color: white; animation: pulse 1.5s infinite; }
    .step-icon.success { background: #10b981; color: white; }
    .step-icon.failed { background: #dc2626; color: white; } /* Darker red */
    .step-text {
      font-size: 12px;
      color: #374151;
      line-height: 1.2;
      word-wrap: break-word;
      margin-bottom: 4px;
    }
    .step-details {
      font-size: 10px;
      color: #6b7280;
      cursor: pointer;
      opacity: 0.7;
    }
    .step-details:hover {
      opacity: 1;
    }
    .step-tooltip {
      display: none;
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px;
      border-radius: 4px;
      font-size: 10px;
      white-space: pre-wrap;
      z-index: 10;
      max-width: 150px;
      text-align: center;
    }
    .step-details:hover + .step-tooltip {
      display: block;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Buttons */
    .button {
      display: block;
      width: 100%;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      padding: 10px 16px;
      border-radius: 6px;
      border: 1px solid transparent;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .button-primary {
      background-color: #2563eb; /* blue-600 */
      color: #ffffff;
    }
    .button-primary:hover {
      background-color: #1d4ed8; /* blue-700 */
    }
    .button-secondary {
      background-color: #16a34a; /* green-600 */
      color: #ffffff;
    }
    .button-secondary:hover {
      background-color: #15803d; /* green-700 */
    }
    .button-warning {
      background-color: #f59e0b; /* yellow-500 */
      color: #1e293b; /* gray-800 */
    }
    .button-warning:hover {
      background-color: #d97706; /* yellow-600 */
    }

    /* States */
    /* All states are hidden by default, JS will show the correct one */
    #loading-state,
    #auth-state,
    #new-contact-state,
    #contact-found-state,
    #success-state,
    #error-state {
      display: none;
    }
  </style>
</head>
<body>

  <div class="container">
    <!-- Header: Visible on all states -->
    <div class="header">
      <div class="header-title">
        <img src="icons/icon48.png" alt="Link3d Logo">
        <span>Link3d Memory</span>
      </div>
      <div id="status-light" title="Status"></div>
    </div>

    <!-- State 1: Loading with Progress -->
    <div id="loading-state" class="card">
      <div class="text-lg font-semibold text-gray-900 mb-2">Processing Profile...</div>
    </div>
    </div>

    <!-- State 2: Needs Authentication -->
    <div id="auth-state" class="card">
      <div class="text-lg font-semibold text-gray-900 mb-2">Permission Needed</div>
      <div class="text-sm text-gray-600 mb-4">
        To sync with your Google Contacts, Link3d needs your permission.
      </div>
      <button id="auth-button" class="button button-warning">
        Authorize Google
      </button>
    </div>

    <!-- State 3: New Contact -->
    <div id="new-contact-state" class="card">
      <div class="progress-container">
        <div class="progress-step" id="step-a">
          <div class="step-icon pending">1</div>
          <div class="step-text">Extracting contact data</div>
          <div class="step-details">+</div>
          <div class="step-tooltip" id="tooltip-a"></div>
        </div>
        <div class="progress-step" id="step-b">
          <div class="step-icon pending">2</div>
          <div class="step-text">AI for analysis</div>
          <div class="step-details">+</div>
          <div class="step-tooltip" id="tooltip-b"></div>
        </div>
        <div class="progress-step" id="step-c">
          <div class="step-icon pending">3</div>
          <div class="step-text">Local AI 1st</div>
        </div>
        <div class="progress-step" id="step-d">
          <div class="step-icon pending">4</div>
          <div class="step-text">Gemini AI fallback</div>
        </div>
        <div class="progress-step" id="step-e">
          <div class="step-icon pending">5</div>
          <div class="step-text">Analysis complete</div>
          <div class="step-details">+</div>
          <div class="step-tooltip" id="tooltip-e"></div>
        </div>
        <div class="progress-step" id="step-f">
          <div class="step-icon pending">6</div>
          <div class="step-text">Google contacts connect</div>
        </div>
        <div class="progress-step" id="step-g">
          <div class="step-icon pending">7</div>
          <div class="step-text">Synching with Google contacts</div>
          <div class="step-details">+</div>
          <div class="step-tooltip" id="tooltip-g"></div>
        </div>
      </div>
      <div class="text-lg font-semibold text-gray-900 mb-1" id="new-name">Contact Name</div>
      <div class="text-sm text-gray-500 mb-3" id="new-title">Contact Title</div>
      <div class="ai-summary mb-4">
        <strong>AI Memory:</strong>
        <span id="new-ai-summary">Generating AI summary...</span>
      </div>
      <button id="create-button" class="button button-primary">
        Create New Contact
      </button>
    </div>

    <!-- State 4: Contact Found -->
    <div id="contact-found-state" class="card">
      <div class="progress-container">
        <div class="progress-step" id="step-a">
          <div class="step-icon pending">1</div>
          <div class="step-text">Extracting contact data</div>
          <div class="step-details">+</div>
          <div class="step-tooltip" id="tooltip-a"></div>
        </div>
        <div class="progress-step" id="step-b">
          <div class="step-icon pending">2</div>
          <div class="step-text">AI for analysis</div>
          <div class="step-details">+</div>
          <div class="step-tooltip" id="tooltip-b"></div>
        </div>
        <div class="progress-step" id="step-c">
          <div class="step-icon pending">3</div>
          <div class="step-text">Local AI 1st</div>
        </div>
        <div class="progress-step" id="step-d">
          <div class="step-icon pending">4</div>
          <div class="step-text">Gemini AI fallback</div>
        </div>
        <div class="progress-step" id="step-e">
          <div class="step-icon pending">5</div>
          <div class="step-text">Analysis complete</div>
          <div class="step-details">+</div>
          <div class="step-tooltip" id="tooltip-e"></div>
        </div>
        <div class="progress-step" id="step-f">
          <div class="step-icon pending">6</div>
          <div class="step-text">Google contacts connect</div>
        </div>
        <div class="progress-step" id="step-g">
          <div class="step-icon pending">7</div>
          <div class="step-text">Synching with Google contacts</div>
          <div class="step-details">+</div>
          <div class="step-tooltip" id="tooltip-g"></div>
        </div>
      </div>
      <div class="text-lg font-semibold text-gray-900 mb-1" id="found-name">Contact Name</div>
      <div class="text-sm text-gray-500 mb-3" id="found-title">Contact Title</div>
      <div class="ai-summary mb-4">
        <strong>New AI Memory:</strong>
        <span id="found-ai-summary">Generating AI summary...</span>
      </div>
      <button id="update-button" class="button button-secondary">
        Add Memory to Contact
      </button>
    </div>

    <!-- State 5: Success -->
    <div id="success-state" class="card">
      <div class="text-lg font-semibold text-gray-900 mb-2" style="color: #16a34a;">Success!</div>
      <div class="text-sm text-gray-600" id="success-message">
        Contact updated successfully.
      </div>
    </div>

    <!-- State 6: Error -->
    <div id="error-state" class="card">
      <div class="text-lg font-semibold text-gray-900 mb-2" style="color: #c5221f;">Error</div>
      <div class="text-sm text-gray-600" id="error-message" style="word-wrap: break-word;">
        An unknown error occurred.
      </div>
    </div>

  </div>

  <!-- 
    The script MUST be loaded at the end of the body.
    This ensures all HTML elements (buttons, etc.) exist before the script tries to find them.
    This prevents the "Cannot read properties of null" error.
  -->
  <script src="popup.js"></script>
</body>
</html>

